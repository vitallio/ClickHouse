DROP USER IF EXISTS u1_01284, u2_01284, u3_01284, u4_01284, u5_01284, u6_01284, u7_01284;

SELECT 'default';
CREATE USER u1_01284;
SHOW CREATE USER u1_01284;

SELECT 'same as default';
CREATE USER u2_01284 NOT IDENTIFIED HOST ANY SETTINGS NONE DEFAULT ROLE ALL;
CREATE USER u3_01284 DEFAULT ROLE ALL IDENTIFIED WITH no password SETTINGS NONE HOST ANY;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;

SELECT 'rename';
ALTER USER u2_01284 RENAME TO 'u2_01284_renamed';
SHOW CREATE USER u2_01284;
SHOW CREATE USER u2_01284_renamed;
DROP USER u1_01284, u2_01284, u3_01284_renamed;

SELECT 'authentication';
CREATE USER u1_01284 NOT IDENTIFIED;
CREATE USER u2_01284 IDENTIFIED WITH plaintext_password BY 'qwe123';
CREATE USER u3_01284 IDENTIFIED BY 'qwe123';
CREATE USER u4_01284 IDENTIFIED WITH sha256_password BY 'qwe123';
CREATE USER u5_01284 IDENTIFIED WITH sha256_password BY 'qwe123'; --hash
CREATE USER u6_01284 IDENTIFIED WITH double_sha1_password BY 'qwe123';
CREATE USER u7_01284 IDENTIFIED WITH double_sha1_password BY 'qwe123'; --hash
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
SHOW CREATE USER u6_01284;
SHOW CREATE USER u7_01284;
ALTER USER u1_01284 IDENTIFIED BY '123qwe';
ALTER USER u2_01284 IDENTIFIED BY '123qwe';
ALTER USER u3_01284 IDENTIFIED BY '123qwe';
ALTER USER u4_01284 IDENTIFIED WITH plaintext_password BY '123qwe';
ALTER USER u5_01284 IDENTIFIED NOT IDENTIFIED;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
DROP USER u1_01284, u2_01284, u3_01284, u4_01284, u5_01284, u6_01284, u7_01284;

SELECT 'host';
CREATE USER u1_01284 HOST ANY;
CREATE USER u2_01284 HOST NONE;
CREATE USER u3_01284 HOST LOCAL;
CREATE USER u4_01284 HOST NAME 'myhost.com';
CREATE USER u5_01284 HOST NAME 'myhost.com', LOCAL;
CREATE USER u6_01284 HOST LOCAL, NAME 'myhost.com';
CREATE USER u7_01284 HOST REGEXP '.*\\.myhost\\.com';
CREATE USER u8_01284 HOST LIKE '%';
CREATE USER u9_01284 HOST LIKE '%.myhost.com';
CREATE USER u10_01284 HOST LIKE '%.myhost.com', '%.myhost2.com';
CREATE USER u11_01284 HOST IP '127.0.0.1';
CREATE USER u12_01284 HOST IP '192.168.1.1';
CREATE USER u13_01284 HOST IP '192.168.0.0/16';
CREATE USER u14_01284 HOST IP '::1';
CREATE USER u15_01284 HOST IP '2001:0db8:11a3:09d7:1f34:8a2e:07a0:765d';
CREATE USER u16_01284 HOST IP '65:ff0c::/96', '::1';
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
SHOW CREATE USER u6_01284;
SHOW CREATE USER u7_01284;
SHOW CREATE USER u8_01284;
SHOW CREATE USER u9_01284;
SHOW CREATE USER u10_01284;
SHOW CREATE USER u11_01284;
SHOW CREATE USER u12_01284;
SHOW CREATE USER u13_01284;
SHOW CREATE USER u14_01284;
SHOW CREATE USER u15_01284;
SHOW CREATE USER u16_01284;
ALTER USER u1_01284 HOST NONE;
ALTER USER u2_01284 HOST NAME 'myhost.com';
ALTER USER u3_01284 ADD HOST NAME 'myhost.com';
ALTER USER u4_01284 DROP HOST NAME 'myhost.com';
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
DROP USER u1_01284, u2_01284, u3_01284, u4_01284, u5_01284, u6_01284, u7_01284, u8_01284, u9_01284;
DROP USER u10_01284, u11_01284, u12_01284, u13_01284, u14_01284, u15_01284, u16_01284;

SELECT 'host after @';
CREATE USER u1_01284@'%';
CREATE USER u2_01284@'%.myhost.com';
CREATE USER u3_01284@'192.168.%.%';
CREATE USER u4_01284@'::1';
CREATE USER u5_01284@'65:ff0c::/96';
SHOW CREATE USER u1_01284@'%';
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284@'%.myhost.com';
SHOW CREATE USER 'u2_01284@%.myhost.com';
SHOW CREATE USER u3_01284@'192.168.%.%';
SHOW CREATE USER 'u3_01284@192.168.%.%';
SHOW CREATE USER u4_01284@'::1';
SHOW CREATE USER 'u4_01284@::1';
SHOW CREATE USER u5_01284@'65:ff0c::/96';
SHOW CREATE USER 'u5_01284@65:ff0c::/96';
ALTER USER u1_01284@'%' HOST LOCAL;
ALTER USER u2_01284@'%.myhost.com' HOST ANY;
SHOW CREATE USER u1_01284@'%';
SHOW CREATE USER u2_01284@'%.myhost.com';
DROP USER u1_01284@'%', 'u2_01284@%.myhost.com', u3_01284@'192.168.%.%', 'u4_01284@::1', u5_01284@'65:ff0c::/96';

SELECT 'settings';
CREATE USER u1_01284 SETTINGS NONE;
CREATE USER u2_01284 SETTINGS PROFILE 'default';
CREATE USER u3_01284 SETTINGS max_memory_usage=5000000;
CREATE USER u4_01284 SETTINGS max_memory_usage MIN=5000000;
CREATE USER u5_01284 SETTINGS max_memory_usage MAX=5000000;
CREATE USER u6_01284 SETTINGS max_memory_usage READONLY;
CREATE USER u7_01284 SETTINGS max_memory_usage WRITABLE;
CREATE USER u8_01284 SETTINGS max_memory_usage=5000000 MIN 4000000 MAX 6000000 READONLY;
CREATE USER u9_01284 SETTINGS PROFILE 'default', max_memory_usage=5000000 WRITABLE;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
SHOW CREATE USER u6_01284;
SHOW CREATE USER u7_01284;
SHOW CREATE USER u8_01284;
SHOW CREATE USER u9_01284;
ALTER USER u1_01284 SETTINGS readonly=1;
ALTER USER u2_01284 SETTINGS readonly=1;
ALTER USER u3_01284 SETTINGS NONE;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
DROP USER u1_01284, u2_01284, u3_01284, u4_01284, u5_01284, u6_01284, u7_01284, u8_01284, u9_01284;

SELECT 'default role';
CREATE ROLE r1, r2;
CREATE USER u1_01284 DEFAULT ROLE ALL;
CREATE USER u2_01284 DEFAULT ROLE NONE;
CREATE USER u3_01284 DEFAULT ROLE r1;
CREATE USER u4_01284 DEFAULT ROLE r1, r2;
CREATE USER u5_01284 DEFAULT ROLE ALL EXCEPT r2;
CREATE USER u6_01284 DEFAULT ROLE ALL EXCEPT r1, r2;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
SHOW CREATE USER u6_01284;
ALTER USER u1_01284 DEFAULT ROLE r1;
ALTER USER u2_01284 DEFAULT ROLE ALL EXCEPT r2;
SET DEFAULT ROLE r2 TO u3_01284;
SET DEFAULT ROLE ALL TO u4_01284;
SET DEFAULT ROLE ALL EXCEPT r1 TO u5_01284;
SET DEFAULT ROLE NONE TO u6_01284;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284;
SHOW CREATE USER u6_01284;
DROP USER u1_01284, u2_01284, u3_01284, u4_01284, u5_01284, u6_01284;
DROP ROLE r1, r2;

SELECT 'complex';
CREATE USER u1_01284 IDENTIFIED WITH plaintext_password BY 'qwe123' HOST LOCAL SETTINGS readonly=1;
SHOW CREATE USER u1_01284;
ALTER USER u1_01284 NOT IDENTIFIED HOST LIKE '%.%.myhost.com' DEFAULT ROLE NONE SETTINGS INHERIT 'default';
SHOW CREATE USER u1_01284;
DROP USER u1_01284;

SELECT 'multiple users in one command';
CREATE USER u1_01284, u2_01284 DEFAULT ROLE NONE;
CREATE USER u3_01284, u4_01284 DEFAULT HOST LIKE '%.%.myhost.com';
CREATE USER u5_01284@'%.host.com', u6_01284@'%.host.com';
CREATE USER u7_01284@'%.host.com', u8_01284@'%.otherhost.com';
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
SHOW CREATE USER u5_01284'%.host.com';
SHOW CREATE USER u6_01284@'%.host.com';
SHOW CREATE USER u7_01284'%.host.com';
SHOW CREATE USER u8_01284@'%.otherhost.com';
ALTER USER u1_01284, u2_01284 SETTINGS readonly=1;
CREATE ROLE r1, r2;
SET DEFAULT ROLE r1, r2 TO u3_01284, u4_01284;
SHOW CREATE USER u1_01284;
SHOW CREATE USER u2_01284;
SHOW CREATE USER u3_01284;
SHOW CREATE USER u4_01284;
DROP USER u1_01284, u2_01284, u3_01284, u4_01284, u5_01284'%.host.com', u6_01284@'%.host.com';
DROP USER u7_01284'%.host.com', u8_01284@'%.otherhost.com';
