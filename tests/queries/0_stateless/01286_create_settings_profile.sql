DROP USER IF EXISTS u1_01284;
DROP ROLE IF EXISTS r1_01284;
DROP PROFILE IF EXISTS s1_01284;
DROP POLICY IF EXISTS p1_01284 ON mydb.mytable;
DROP QUOTA IF EXISTS q1_01284;

--------------------------------------------------------

SELECT 'simple';

CREATE USER u1_01284;
CREATE ROLE r1_01284;
CREATE PROFILE s1_01284;
CREATE POLICY p1_01284 ON mydb.mytable;
CREATE QUOTA q1_01284;

SHOW CREATE USER u1_01284;
SHOW CREATE ROLE r1_01284;
SHOW CREATE PROFILE s1_01284;
SHOW CREATE POLICY p1_01284 ON mydb.mytable;
SHOW CREATE QUOTA q1_01284;

--------------------------------------------------------

SELECT 'complex';

CREATE USER u2_01284 IDENTIFIED WITH plaintext_password BY 'qwe123' HOST LOCAL SETTINGS readonly=1;
CREATE ROLE r2_01284 SETTINGS max_threads=5;
CREATE PROFILE s2_01284 SETTINGS INHERIT s1_01284 TO r1_01284;
CREATE POLICY p2_01284 ON mydb.mytable USING id=currentUser() TO u2_01284;
CREATE QUOTA q2_01284 FOR RANDOMIZED INTERVAL 1 day MAX ERRORS = 5 TO ALL EXCEPT u2_01284;

SHOW CREATE USER u2_01284;
SHOW CREATE ROLE r2_01284;
SHOW CREATE PROFILE s2_01284;
SHOW CREATE POLICY p2_01284 ON mydb.mytable;
SHOW CREATE QUOTA q2_01284;

--------------------------------------------------------

SELECT 'alias';

CREATE SETTINGS PROFILE s3_01284;
CREATE ROW POLICY p3_01284 ON mydb.mytable;

SHOW CREATE SETTINGS PROFILE s3_01284;
SHOW CREATE ROW POLICY p3_01284 ON mydb.mytable;
SHOW CREATE SETTINGS PROFILE s2_01284;
SHOW CREATE ROW POLICY p2_01284 ON mydb.mytable;
